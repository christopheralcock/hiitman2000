<head>
  <style>
    div {
        font-size: 50px;
    }
    #currentExercise {
        color: blue;
    }
    #break {
        color: green;
    }
    #readyClock {

      font-size: 150px;
    }

  </style>
</head>
<body>
  <h1>HIITMAN 2000: THE SINGLE MOST ADVANCED HIIT WEBSITE</h1>
    <div id=complete>
    <div id=currentExercise>
    </div>
    <div id=break>
    </div>
    <div id=readyClock>
    </div>
    <div id=percentageDone>
  </div>

  <p>example params: <a href="?e=squats,press-ups,sit-ups,skipping+rope&t=0.5&b=0.5&w=20">?e=squats,press-ups,sit-ups,skipping+rope&t=0.5&b=0.5&w=20</a></p>
  <p>e: a comma separated list of the names of the exercises you want to do, eg squats,press-ups,sit-ups,skipping rope</p>
  <p>t: in minutes, how long you want each bit of excercise to last, eg 0.5</p>
  <p>b: in minutes, how long you want each break between exercise to last, eg 0.5</p>
  <p>w: in minutes, how long you want the session to last, eg 20</p>


  <script>
  audioContext = new AudioContext();

  var url_string = window.location.href
var url = new URL(url_string);

todayExercises = ["Mountain Climber","Squatty Floor Touch","Snakey Dog Pressups","Punchy Boys","High Knees!!"];
breakLength = 30000;
exerciseLength = 30000;
workoutLength = 20*60000;
  if (url.searchParams.get("e")){
    todayExercises = url.searchParams.get("e").split(",");
  }
  if (url.searchParams.get("b")){
    breakLength = url.searchParams.get("b")*60000;
  }

  if (url.searchParams.get("t")){
   exerciseLength = url.searchParams.get("t")*60000;
  }
  segmentLength = breakLength + exerciseLength;

  if (url.searchParams.get("w")){
    workoutLength = url.searchParams.get("w")*60000;
  }

  document.getElementById("currentExercise").innerHTML = "welcome! up next: "+todayExercises[0]+ " in:";
  document.getElementById("readyClock").innerHTML = segmentLength/1000;
  setInterval(countDown, 1000);
  function countDown(){
    previousCount = document.getElementById("readyClock").innerHTML;
    newCount = previousCount - 1;
        document.getElementById("readyClock").innerHTML=newCount;
  }
  setInterval(function(){
    document.getElementById("readyClock").innerHTML=exerciseLength/1000;

    lastExercise = document.getElementById("currentExercise").innerHTML;
    lastExerciseIndex = todayExercises.indexOf(lastExercise);
    newExerciseIndex = (lastExerciseIndex + 1) % todayExercises.length;
    nextExerciseIndex = (newExerciseIndex + 1) % todayExercises.length;
    beep();
    setTimeout(function(){
      document.getElementById("break").innerHTML = "BREAK!! up next: "+todayExercises[nextExerciseIndex];
      beep();
      document.getElementById("readyClock").innerHTML=(segmentLength-exerciseLength)/1000;

    },exerciseLength)
    setTimeout(function(){
      document.getElementById("break").innerHTML = "";
    },segmentLength)
    document.getElementById("currentExercise").innerHTML = todayExercises[newExerciseIndex];
  }, segmentLength);
  setTimeout(function(){
    document.getElementById("complete").innerHTML = "WORKOUT COMPLETE!";
    beep();

  }, (workoutLength + segmentLength));
  setTimeout(function(){ percentageDone() }, segmentLength);
  percentage = 0;
  function percentageDone(){
    setInterval(function(){
      document.getElementById("percentageDone").innerHTML = percentage +"%";
      percentage++;
    },
    (workoutLength/100)
  );

  }
  function beep() {
    var startTime = audioContext.currentTime;
    var endTime = startTime + 0.5;
    var oscillator = audioContext.createOscillator();
    oscillator.connect(audioContext.destination);
    oscillator.type = "square";
    oscillator.start(startTime);
    oscillator.stop(endTime);

};

  </script>
</body>
