<head>
  <style>
    div {
        font-size: 50px;
    }
    #currentExercise {
        color: blue;
    }
    #break {
        color: green;
    }
    #clock {
      font-size: 200px;
    }
    p {
      font-size: 15px;
    }
    h1 {
      font-size: 50px;
    }
    body {
      text-align: center;
    }

  </style>
</head>
<body>
  <h1>HIITMAN 2000:</h1>
<h2>THE SINGLE MOST ADVANCED HIIT WEBSITE</h2>
    <div id=complete>
    <div id=currentExercise>
      You seem to be using a rubbish browser and/or an iPhone. This website won't make any sense, sorry. Working on it, a bit, maybe.

    </div>
    <div id=break>
    </div>
    <div id=clock>
    </div>
    <div id=percentageDone>
  </div>

  <p>example params: <a href="?e=squats,press-ups,sit-ups,skipping+rope&t=30&b=30&w=20">?e=squats,press-ups,sit-ups,skipping+rope&t=30&b=30&w=20</a></p>
  <p>e: a comma separated list of the names of the exercises you want to do, eg squats,press-ups,sit-ups,skipping rope</p>
  <p>t: in seconds, how long you want each bit of excercise to last, eg 30</p>
  <p>b: in seconds, how long you want each break between exercise to last, eg 30</p>
  <p>w: in minutes, how long you want the session to last, eg 20</p>


  <script>
  audioContext = new AudioContext();

  var url_string = window.location.href
var url = new URL(url_string);

todayExercises = ["Mountain Climber","Squatty Floor Touch","Snakey Dog Pressups","Punchy Boys","High Knees!!"];
breakLength = 30000;
exerciseLength = 30000;
workoutLength = 20*60000;
  if (url.searchParams.get("e")){
    todayExercises = url.searchParams.get("e").split(",");
  }
  if (url.searchParams.get("b")){
    breakLength = url.searchParams.get("b")*1000;
  }

  if (url.searchParams.get("t")){
   exerciseLength = url.searchParams.get("t")*1000;
  }
  segmentLength = breakLength + exerciseLength;

  if (url.searchParams.get("w")){
    workoutLength = url.searchParams.get("w")*60000;
  }
  document.getElementById("currentExercise").innerHTML = "Welcome! Stretch a bit and get ready!\r Up first: "+todayExercises[0]+ " in:";
  document.getElementById("clock").innerHTML = segmentLength/1000;
  setInterval(countDown, 1000);
  function countDown(){
    previousCount = document.getElementById("clock").innerHTML;
    newCount = previousCount - 1;
        document.getElementById("clock").innerHTML=newCount;
  }
  setInterval(function(){
    document.getElementById("clock").innerHTML=exerciseLength/1000;

    lastExercise = document.getElementById("currentExercise").innerHTML;
    lastExerciseIndex = todayExercises.indexOf(lastExercise);
    newExerciseIndex = (lastExerciseIndex + 1) % todayExercises.length;
    nextExerciseIndex = (newExerciseIndex + 1) % todayExercises.length;
    beep();
    setTimeout(function(){
      document.getElementById("break").innerHTML = "BREAK!! up next: "+todayExercises[nextExerciseIndex];
      beep();
      document.getElementById("clock").innerHTML=(segmentLength-exerciseLength)/1000;

    },exerciseLength)
    setTimeout(function(){
      document.getElementById("break").innerHTML = "";
    },segmentLength)
    document.getElementById("currentExercise").innerHTML = todayExercises[newExerciseIndex];
  }, segmentLength);
  setTimeout(function(){
    document.getElementById("complete").innerHTML = "WORKOUT COMPLETE!";
    beep();

  }, (workoutLength + segmentLength));

  setTimeout(function(){ percentageDone() }, segmentLength);
  percentage = 0;

  function percentageDone(){
    document.getElementById("percentageDone").innerHTML = percentage +"% complete";

    setInterval(function(){
      percentage++;
      document.getElementById("percentageDone").innerHTML = percentage +"% complete";
    },
    (workoutLength/100)
  );

  }
  function beep() {
    var startTime = audioContext.currentTime;
    var endTime = startTime + 0.5;
    var oscillator = audioContext.createOscillator();
    oscillator.connect(audioContext.destination);
    oscillator.type = "square";
    oscillator.start(startTime);
    oscillator.stop(endTime);

};

  </script>
</body>
